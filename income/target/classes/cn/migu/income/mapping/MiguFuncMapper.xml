<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.migu.income.dao.MiguFuncMapper" >

  <resultMap id="BaseResultMap" type="cn.migu.income.pojo.MiguFunc" >
    <id column="FUNC_ID" property="funcId" jdbcType="DECIMAL" />
    <result column="FUNC_PID" property="funcPid" jdbcType="DECIMAL" />
    <result column="FUNC_NAME" property="funcName" jdbcType="VARCHAR" />
    <result column="FUNC_PAGE_SRC" property="funcPageSrc" jdbcType="VARCHAR" />
    <result column="FUNC_ORDER" property="funcOrder" jdbcType="DECIMAL" />
    <result column="FUNC_IS_IFRAME" property="funcIsIframe" jdbcType="DECIMAL" />
    <result column="CRTATE_DATE" property="crtateDate" jdbcType="DATE" />
    <result column="FUNC_ICON_CLASS" property="funcIconClass" jdbcType="VARCHAR" />
  </resultMap>
  
  <!-- 根据用户查询菜单权限 -->
  <select id="getFuncListByUserId" resultMap="BaseResultMap" parameterType="java.lang.String">
    SELECT 
    C.FUNC_ID, C.FUNC_PID, C.FUNC_NAME, C.FUNC_PAGE_SRC, C.FUNC_ORDER, C.FUNC_IS_IFRAME, C.CRTATE_DATE, C.FUNC_ICON_CLASS
    FROM T_MIGU_USER_ROLE A, T_MIGU_FUNC_ROLE B, T_MIGU_FUNC C
    WHERE A.ROLE_ID = B.ROLE_ID
    AND B.FUNC_ID = C.FUNC_ID
    AND A.USER_ID = #{0}
  </select>
  
  <!-- 根据角色查询二级菜单权限 -->
  <select id="queryAllFunc" resultMap="BaseResultMap">
  	SELECT A.FUNC_ID, A.FUNC_PID, A.FUNC_NAME, A.FUNC_PAGE_SRC, A.FUNC_ORDER, C.FLAG FUNC_IS_IFRAME, A.CRTATE_DATE, A.FUNC_ICON_CLASS
  	FROM  T_MIGU_FUNC A, (SELECT A.FUNC_ID, B.FLAG FROM T_MIGU_FUNC A, T_MIGU_FUNC_ROLE B WHERE A.FUNC_ID = B.FUNC_ID AND B.ROLE_ID = #{0}) C
  	WHERE A.FUNC_ID = C.FUNC_ID(+)
  	And A.FUNC_PID = 0
  	ORDER BY FUNC_ID
  </select>
  
  <!-- 为角色树查询单个权限 -->
  <select id="queryFuncByIdForTree" resultMap="BaseResultMap">
  	SELECT A.FUNC_ID, A.FUNC_PID, A.FUNC_NAME, A.FUNC_PAGE_SRC, A.FUNC_ORDER, A.FUNC_IS_IFRAME, A.CRTATE_DATE, A.FUNC_ICON_CLASS
  	FROM T_MIGU_FUNC A
  	WHERE A.FUNC_ID = #{0}
  </select>
  
  <!-- 根据父菜单查询子菜单 -->
  <select id="querySubmenu" resultMap="BaseResultMap" parameterType="java.lang.String">
    SELECT 
    C.FUNC_ID, C.FUNC_PID, C.FUNC_NAME, C.FUNC_PAGE_SRC, C.FUNC_ORDER, C.FUNC_IS_IFRAME, C.CRTATE_DATE, C.FUNC_ICON_CLASS
    FROM T_MIGU_USER_ROLE A, T_MIGU_FUNC_ROLE B, T_MIGU_FUNC C
    WHERE A.ROLE_ID = B.ROLE_ID
    AND B.FUNC_ID = C.FUNC_ID
    And C.FUNC_PID = #{0}
    AND A.USER_ID = #{1}
    ORDER BY FUNC_ID
  </select>
  
  <!-- 根据角色查询二级菜单权限 -->
  <select id="querySubFun" resultMap="BaseResultMap">
  	SELECT A.FUNC_ID, A.FUNC_PID, A.FUNC_NAME, A.FUNC_PAGE_SRC, A.FUNC_ORDER, C.FLAG FUNC_IS_IFRAME, A.CRTATE_DATE, A.FUNC_ICON_CLASS
  	FROM  T_MIGU_FUNC A, (SELECT A.FUNC_ID, B.FLAG FROM T_MIGU_FUNC A, T_MIGU_FUNC_ROLE B WHERE A.FUNC_ID = B.FUNC_ID AND B.ROLE_ID = #{1}) C
  	WHERE A.FUNC_ID = C.FUNC_ID(+)
  	And A.FUNC_PID = #{0}
  	ORDER BY FUNC_ID
  </select>
  
  <!-- 根据角色查询菜单权限 -->
  <select id="queryAllFuncByMenu" resultMap="BaseResultMap">
  	SELECT A.FUNC_ID, A.FUNC_PID, A.FUNC_NAME, A.FUNC_PAGE_SRC, A.FUNC_ORDER, C.FLAG FUNC_IS_IFRAME, A.CRTATE_DATE, A.FUNC_ICON_CLASS
  	FROM  T_MIGU_FUNC A, (SELECT A.FUNC_ID, B.FLAG FROM T_MIGU_FUNC A, T_MIGU_FUNC_ROLE B WHERE A.FUNC_ID = B.FUNC_ID AND B.ROLE_ID = #{0}) C
  	WHERE A.FUNC_ID = C.FUNC_ID(+)
  	ORDER BY FUNC_ID
  </select>
  
</mapper>