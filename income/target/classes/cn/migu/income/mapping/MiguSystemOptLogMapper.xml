<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.migu.income.dao.MiguSystemOptLogMapper" >
  <resultMap id="BaseResultMap" type="cn.migu.income.pojo.MiguSystemOptLog" >
    <result column="USER_ID" property="userId" jdbcType="VARCHAR" />
    <result column="LOG_DATE" property="logDate" jdbcType="DATE" />
    <result column="OPERATION" property="operation" jdbcType="VARCHAR" />
    <result column="COMMENTS" property="comments" jdbcType="VARCHAR" />
    <result column="USER_LOGIN_IP" property="userLoginIp" jdbcType="VARCHAR" />
  </resultMap>

  <insert id="insert" parameterType="cn.migu.income.pojo.MiguSystemOptLog" >
    insert into T_MIGU_SYSLOG (USER_ID, LOG_DATE, OPERATION, 
      COMMENTS,USER_LOGIN_IP)
    values (#{userId,jdbcType=VARCHAR}, sysdate, #{operation,jdbcType=VARCHAR}, 
      #{comments,jdbcType=VARCHAR},#{userLoginIp,jdbcType=VARCHAR})
  </insert>
  
  <sql id="Base_Column_List" >
   
    USER_ID, LOG_DATE, OPERATION, COMMENTS, USER_LOGIN_IP
  </sql>
  
  <!-- 查询条件设置 -->
  <sql id="where_sql">
     <if test="userName != null and userName != '' "> 
        AND tt.USER_NAME = #{userName} 
     </if>
     <if test="startDate != null and startDate != ''"> 
        AND   to_char(tt.LOG_DATE, 'mm/dd/yyyy') >= #{startDate}
     </if>
      <if test=" endDate != null and endDate != ''"> 
        AND   to_char(tt.LOG_DATE, 'mm/dd/yyyy') <![CDATA[ <=]]> #{endDate}
     </if>
     <if test="operation != null and operation != '' "> 
       AND tt.OPERATION like concat(concat('%',#{operation}),'%')  ESCAPE '\'
     </if>
    
  </sql>
  
  <!-- 查询条件下的总数量 -->
 <select id="querySyslogTotal" resultType="java.lang.Integer" >
select count(*)
  from (select tt.USER_ID   as userId,
       tt.USER_NAME as userName,
       tt.LOG_DATE  as logDate,
       tt.OPERATION as operation,
       tt.COMMENTS  as comments,
       rownum       as rn
  from (select t.*,ts.user_name from T_MIGU_SYSLOG t ,T_MIGU_USERS ts where t.user_id = ts.user_id order by t.LOG_DATE DESC) tt
        <where>
	         <include refid="where_sql"/>
	    </where>
        ) at
  </select>
  <!-- 查询条件下的分页查询 curPage当前页; pageSize 每页显示数 -->
  
  <select id="queryAllSyslog"  resultType="cn.migu.income.pojo.MiguSystemOptLog">
select at.*
  from (select tt.USER_ID   as userId,
       tt.USER_NAME as userName,
       tt.LOG_DATE  as logDate,
       tt.OPERATION as operation,
       tt.COMMENTS  as comments,
       tt.USER_LOGIN_IP  as userLoginIp,
       rownum       as rn
  from (select t.*,ts.user_name from T_MIGU_SYSLOG t ,T_MIGU_USERS ts where t.user_id = ts.user_id order by t.LOG_DATE DESC) tt
        <where>
	         <include refid="where_sql"/>
	    </where>
        ) at
 where at.rn between (#{curPage}-1) * #{pageSize} + 1 and (#{curPage}) * #{pageSize} 
	
  </select>
  
</mapper>